package com.nsfl.tpetracker.html

import com.nsfl.tpetracker.model.player.ActivePlayer
import com.nsfl.tpetracker.model.player.Player
import com.nsfl.tpetracker.model.player.RetiredPlayer
import com.nsfl.tpetracker.model.position.Position
import com.nsfl.tpetracker.model.team.Team
import java.text.SimpleDateFormat
import java.util.*
import kotlin.collections.ArrayList

private const val INDEX_HTML = "<!doctypehtml><title>TPE Tracker</title><link href=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css rel=stylesheet><script src=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.bundle.min.js></script><br><br><div class=container><div class=row><a class=\"col-md-6 mb-4 col-xl-6\"href=/all_players><div class=\"border-0 card shadow\"><img class=card-img-top src=\"\"><div class=\"card-body text-center\"><br><h5 class=\"card-title mb-0\">All Players</h5><br></div></div></a><a class=\"col-md-6 mb-4 col-xl-6\"href=/team_stats><div class=\"border-0 card shadow\"><img class=card-img-top src=\"\"><div class=\"card-body text-center\"><br><h5 class=\"card-title mb-0\">Team Stats</h5><br></div></div></a><a class=\"col-md-6 mb-4 col-xl-6\"href=/position_stats><div class=\"border-0 card shadow\"><img class=card-img-top src=\"\"><div class=\"card-body text-center\"><br><h5 class=\"card-title mb-0\">Position Stats</h5><br></div></div></a><a class=\"col-md-6 mb-4 col-xl-6\"href=/activity_check_query><div class=\"border-0 card shadow\"><img class=card-img-top src=\"\"><div class=\"card-body text-center\"><br><h5 class=\"card-title mb-0\">Activity Check</h5><br></div></div></a></div></div><br><div class=container><div class=row><a class=\"col-md-6 mb-4 col-xl-4\"href=/baltimore_hawks><div class=\"border-0 card shadow\"><img class=card-img-top src=https://i.imgur.com/V7b1IrD.png><div class=\"card-body text-center\"><h5 class=\"card-title mb-0\">Baltimore Hawks</h5></div></div></a><a class=\"col-md-6 mb-4 col-xl-4\"href=/chicago_butchers><div class=\"border-0 card shadow\"><img class=card-img-top src=https://cdn.discordapp.com/attachments/480923375913664524/588935077392547840/CHIBanner.png><div class=\"card-body text-center\"><h5 class=\"card-title mb-0\">Chicago Butchers</h5></div></div></a><a class=\"col-md-6 mb-4 col-xl-4\"href=/colorado_yeti><div class=\"border-0 card shadow\"><img class=card-img-top src=https://i.imgur.com/F82SkOe.png><div class=\"card-body text-center\"><h5 class=\"card-title mb-0\">Colorado Yeti</h5></div></div></a><a class=\"col-md-6 mb-4 col-xl-4\"href=/philadelphia_liberty><div class=\"border-0 card shadow\"><img class=card-img-top src=https://i.imgur.com/e26kJIj.png><div class=\"card-body text-center\"><h5 class=\"card-title mb-0\">Philadelphia Liberty</h5></div></div></a><a class=\"col-md-6 mb-4 col-xl-4\"href=/yellowknife_wraiths><div class=\"border-0 card shadow\"><img class=card-img-top src=https://i.imgur.com/HTNIYcS.png><div class=\"card-body text-center\"><h5 class=\"card-title mb-0\">Yellowknife Wraiths</h5></div></div></a><a class=\"col-md-6 mb-4 col-xl-4\"href=/arizona_outlaws><div class=\"border-0 card shadow\"><img class=card-img-top src=https://i.imgur.com/Run36h3.png><div class=\"card-body text-center\"><h5 class=\"card-title mb-0\">Arizona Outlaws</h5></div></div></a><a class=\"col-md-6 mb-4 col-xl-4\"href=/austin_copperheads><div class=\"border-0 card shadow\"><img class=card-img-top src=https://cdn.discordapp.com/attachments/480923375913664524/588936405548400641/AUSBanner.png><div class=\"card-body text-center\"><h5 class=\"card-title mb-0\">Austin Copperheads</h5></div></div></a><a class=\"col-md-6 mb-4 col-xl-4\"href=/new_orleans_second_line><div class=\"border-0 card shadow\"><img class=card-img-top src=https://i.imgur.com/39Pv6j6.png><div class=\"card-body text-center\"><h5 class=\"card-title mb-0\">New Orleans Second Line</h5></div></div></a><a class=\"col-md-6 mb-4 col-xl-4\"href=/orange_county_otters><div class=\"border-0 card shadow\"><img class=card-img-top src=https://i.imgur.com/A1jDLTx.png><div class=\"card-body text-center\"><h5 class=\"card-title mb-0\">Orange County Otters</h5></div></div></a><a class=\"col-md-6 mb-4 col-xl-4\"href=/san_jose_sabercats><div class=\"border-0 card shadow\"><img class=card-img-top src=https://i.imgur.com/WKAzCvY.png><div class=\"card-body text-center\"><h5 class=\"card-title mb-0\">San Jose SaberCats</h5></div></div></a></div></div><br><div class=container><div class=row><a class=\"col-md-6 mb-4 col-xl-4\"href=/myrtle_beach_buccaneers><div class=\"border-0 card shadow\"><img class=card-img-top src=https://cdn.discordapp.com/attachments/589456641447952387/634231640155226123/MBbanner.png><div class=\"card-body text-center\"><h5 class=\"card-title mb-0\">Myrtle Beach Buccaneers</h5></div></div></a><a class=\"col-md-6 mb-4 col-xl-4\"href=/london_royals><div class=\"border-0 card shadow\"><img class=card-img-top src=https://i.imgur.com/FG0PXqA.png><div class=\"card-body text-center\"><h5 class=\"card-title mb-0\">London Royals</h5></div></div></a><a class=\"col-md-6 mb-4 col-xl-4\"href=/dallas_birddogs><div class=\"border-0 card shadow\"><img class=card-img-top src=https://i.imgur.com/MtLEciQ.png><div class=\"card-body text-center\"><h5 class=\"card-title mb-0\">Dallas Birddogs</h5></div></div></a><a class=\"col-md-6 mb-4 col-xl-4\"href=/kansas_city_coyotes><div class=\"border-0 card shadow\"><img class=card-img-top src=https://media.discordapp.net/attachments/574036391038812180/593205480038596658/KCCBanner.png><div class=\"card-body text-center\"><h5 class=\"card-title mb-0\">Kansas City Coyotes</h5></div></div></a><a class=\"col-md-6 mb-4 col-xl-4\"href=/portland_pythons><div class=\"border-0 card shadow\"><img class=card-img-top src=https://i.imgur.com/g1jBrkG.png><div class=\"card-body text-center\"><h5 class=\"card-title mb-0\">Portland Pythons</h5></div></div></a><a class=\"col-md-6 mb-4 col-xl-4\"href=/norfolk_seawolves><div class=\"border-0 card shadow\"><img class=card-img-top src=https://i.imgur.com/rUbmsUh.png><div class=\"card-body text-center\"><h5 class=\"card-title mb-0\">Norfolk SeaWolves</h5></div></div></a><a class=\"col-md-6 mb-4 col-xl-4\"href=/minnesota_grey_ducks><div class=\"border-0 card shadow\"><img class=card-img-top src=https://cdn.discordapp.com/attachments/650514725192466443/651621525840986122/MINBanner1_blue.png><div class=\"card-body text-center\"><h5 class=\"card-title mb-0\">Minnesota Grey Ducks</h5></div></div></a><a class=\"col-md-6 mb-4 col-xl-4\"href=/tijuana_luchadores><div class=\"border-0 card shadow\"><img class=card-img-top src=https://i.imgur.com/Rqa9DsX.png><div class=\"card-body text-center\"><h5 class=\"card-title mb-0\">Tijuana Luchadores</h5></div></div></a></div></div><br><div class=container><div class=row><a class=\"col-md-6 mb-4 col-xl-4\"href=/free_agents><div class=\"border-0 card shadow\"><div class=\"card-body text-center\"><h5 class=\"card-title mb-0\">Free Agents</h5></div></div></a><a class=\"col-md-6 mb-4 col-xl-4\"href=/qb_prospects><div class=\"border-0 card shadow\"><div class=\"card-body text-center\"><h5 class=\"card-title mb-0\">QB Prospects</h5></div></div></a><a class=\"col-md-6 mb-4 col-xl-4\"href=/rb_prospects><div class=\"border-0 card shadow\"><div class=\"card-body text-center\"><h5 class=\"card-title mb-0\">RB Prospects</h5></div></div></a><a class=\"col-md-6 mb-4 col-xl-4\"href=/wr_prospects><div class=\"border-0 card shadow\"><div class=\"card-body text-center\"><h5 class=\"card-title mb-0\">WR Prospects</h5></div></div></a><a class=\"col-md-6 mb-4 col-xl-4\"href=/te_prospects><div class=\"border-0 card shadow\"><div class=\"card-body text-center\"><h5 class=\"card-title mb-0\">TE Prospects</h5></div></div></a><a class=\"col-md-6 mb-4 col-xl-4\"href=/ol_prospects><div class=\"border-0 card shadow\"><div class=\"card-body text-center\"><h5 class=\"card-title mb-0\">OL Prospects</h5></div></div></a><a class=\"col-md-6 mb-4 col-xl-4\"href=/de_prospects><div class=\"border-0 card shadow\"><div class=\"card-body text-center\"><h5 class=\"card-title mb-0\">DE Prospects</h5></div></div></a><a class=\"col-md-6 mb-4 col-xl-4\"href=/dt_prospects><div class=\"border-0 card shadow\"><div class=\"card-body text-center\"><h5 class=\"card-title mb-0\">DT Prospects</h5></div></div></a><a class=\"col-md-6 mb-4 col-xl-4\"href=/lb_prospects><div class=\"border-0 card shadow\"><div class=\"card-body text-center\"><h5 class=\"card-title mb-0\">LB Prospects</h5></div></div></a><a class=\"col-md-6 mb-4 col-xl-4\"href=/cb_prospects><div class=\"border-0 card shadow\"><div class=\"card-body text-center\"><h5 class=\"card-title mb-0\">CB Prospects</h5></div></div></a><a class=\"col-md-6 mb-4 col-xl-4\"href=/s_prospects><div class=\"border-0 card shadow\"><div class=\"card-body text-center\"><h5 class=\"card-title mb-0\">S Prospects</h5></div></div></a><a class=\"col-md-6 mb-4 col-xl-4\"href=/kp_prospects><div class=\"border-0 card shadow\"><div class=\"card-body text-center\"><h5 class=\"card-title mb-0\">K/P Prospects</h5></div></div></a><a class=\"col-md-6 mb-4 col-xl-4\"href=/retired_players><div class=\"border-0 card shadow\"><div class=\"card-body text-center\"><h5 class=\"card-title mb-0\">Retired Players</h5></div></div></a></div></div><br><br>"
private const val ALL_PLAYERS_HTML = "<!doctypehtml><title>All Players</title><link href=https://cdn.datatables.net/1.10.19/css/dataTables.bootstrap4.min.css rel=stylesheet><link href=https://cdn.datatables.net/buttons/1.5.6/css/buttons.bootstrap4.min.css rel=stylesheet><link href=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css rel=stylesheet><script src=https://code.jquery.com/jquery-3.3.1.js></script><script src=https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js></script><script src=https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap4.min.js></script><script src=https://cdn.datatables.net/buttons/1.5.6/js/dataTables.buttons.min.js></script><script src=https://cdn.datatables.net/buttons/1.5.6/js/buttons.bootstrap4.min.js></script><script src=https://cdn.datatables.net/buttons/1.5.6/js/buttons.colVis.min.js></script><script src=https://cdn.datatables.net/plug-ins/1.10.19/sorting/enum.js></script><script src=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.bundle.min.js></script><script class=init>var dataSet=[%s];\$(document).ready(function(){\$.fn.dataTable.enum([\"Quarterback\",\"Running Back\",\"Wide Receiver\",\"Tight End\",\"Offensive Line\",\"Defensive End\",\"Defensive Tackle\",\"Linebacker\",\"Cornerback\",\"Safety\",\"Kicker/Punter\",\"Unknown\"]);var t=\$(\"#table\").DataTable({dom:\"<'row'<'col-sm-6'B><'col-sm-6'f>><'row'<'col-sm-12'tr>><'row'<'col-sm-5'i><'col-sm-7'p>>\",scrollX:!0,paging:!1,order:[[5,\"desc\"]],buttons:[{text:\"Toggle All\",action:function(){t.columns().visible(!t.column(0).visible())}},{text:\"Toggle Attributes\",action:function(){t.columns([9,10,11,12,13,14,15,16,17,18,19,20,21]).visible(!t.column(9).visible())}},{extend:'colvis',text:'Toggle Columns'}],data:dataSet,columns:[{title:\"User\"},{title:\"Draft Year\"},{title:\"Team\"},{title:\"Name\"},{title:\"Position\"},{title:\"Current TPE\"},{title:\"Highest TPE\"},{title:\"Last Updated\"},{title:\"Last Seen\"},{title:\"Str\"},{title:\"Agi\"},{title:\"Arm\"},{title:\"Int\"},{title:\"Thr\"},{title:\"Tck\"},{title:\"Spd\"},{title:\"Hnd\"},{title:\"PBlk\"},{title:\"RBlk\"},{title:\"End\"},{title:\"KPow\"},{title:\"KAcc\"}]})});</script><style>td{white-space:nowrap;font-size:14px}th{white-space:nowrap;font-size:12px}.dataTables_info{font-size:14px}caption{padding-bottom:20px;caption-side:top}</style><nav class=\"bg-light navbar navbar-expand-lg navbar-light rounded\"><button aria-controls=navbar aria-expanded=false aria-label=\"Toggle navigation\"class=\"collapsed navbar-toggler\"data-target=#navbar data-toggle=collapse type=button><span class=navbar-toggler-icon></span></button><div class=\"collapse navbar-collapse\"id=navbar><ul class=\"mr-auto navbar-nav\"><li class=\"nav-item active\"><a class=nav-link href=/ >Home</a><li class=nav-item><a class=nav-link href=/all_players>All Players</a><li class=nav-item><a class=nav-link href=/team_stats>Team Stats</a><li class=nav-item><a class=nav-link href=/position_stats>Position Stats</a><li class=nav-item><a class=nav-link href=/activity_check_query>Activity Check</a><li class=\"nav-item dropdown\"><a class=\"nav-link dropdown-toggle\"href=NSFL aria-expanded=false aria-haspopup=true data-toggle=dropdown id=nsfl>NSFL</a><div class=dropdown-menu aria-labelledby=nsfl><a class=dropdown-item href=/baltimore_hawks>Baltimore Hawks</a><a class=dropdown-item href=/chicago_butchers>Chicago Butchers</a><a class=dropdown-item href=/colorado_yeti>Colorado Yeti</a><a class=dropdown-item href=/philadelphia_liberty>Philadelphia Liberty</a><a class=dropdown-item href=/yellowknife_wraiths>Yellowknife Wraiths</a><a class=dropdown-item href=/arizona_outlaws>Arizona Outlaws</a><a class=dropdown-item href=/austin_copperheads>Austin Copperheads</a><a class=dropdown-item href=/new_orleans_second_line>New Orleans Second Line</a><a class=dropdown-item href=/orange_county_otters>Orange County Otters</a><a class=dropdown-item href=/san_jose_sabercats>San Jose SaberCats</a></div><li class=\"nav-item dropdown\"><a class=\"nav-link dropdown-toggle\"href=DSFL aria-expanded=false aria-haspopup=true data-toggle=dropdown id=dsfl>DSFL</a><div class=dropdown-menu aria-labelledby=dsfl><a class=dropdown-item href=/myrtle_beach_buccaneers>Myrtle Beach Buccaneers</a><a class=dropdown-item href=/dallas_birddogs>Dallas Birddogs</a><a class=dropdown-item href=/london_royals>London Royals</a><a class=dropdown-item href=/kansas_city_coyotes>Kansas City Coyotes</a><a class=dropdown-item href=/portland_pythons>Portland Pythons</a><a class=dropdown-item href=/norfolk_seawolves>Norfolk SeaWolves</a><a class=dropdown-item href=/minnesota_grey_ducks>Minnesota Grey Ducks</a><a class=dropdown-item href=/tijuana_luchadores>Tijuana Luchadores</a></div><li class=nav-item><a class=nav-link href=/free_agents>Free Agents</a><li class=\"nav-item dropdown\"><a class=\"nav-link dropdown-toggle\"href=Prospects aria-expanded=false aria-haspopup=true data-toggle=dropdown id=prospects>Prospects</a><div class=dropdown-menu aria-labelledby=prospects><a class=dropdown-item href=/qb_prospects>QB Prospects</a><a class=dropdown-item href=/rb_prospects>RB Prospects</a><a class=dropdown-item href=/wr_prospects>WR Prospects</a><a class=dropdown-item href=/te_prospects>TE Prospects</a><a class=dropdown-item href=/ol_prospects>OL Prospects</a><a class=dropdown-item href=/de_prospects>DE Prospects</a><a class=dropdown-item href=/dt_prospects>DT Prospects</a><a class=dropdown-item href=/lb_prospects>LB Prospects</a><a class=dropdown-item href=/cb_prospects>CB Prospects</a><a class=dropdown-item href=/s_prospects>S Prospects</a><a class=dropdown-item href=/kp_prospects>K/P Prospects</a></div><li class=nav-item><a class=nav-link href=/retired_players>Retired Players</a></ul></div></nav><div style=padding-left:80px;padding-right:80px;padding-top:40px;padding-bottom:20px;color:rgba(0,0,0,.87);font-size:28px;text-align:center>All Players</div><div style=padding-left:80px;padding-right:80px;padding-top:20px;padding-bottom:40px><table class=\"celled table ui\"id=table width=100%%><caption></table></div>"
private const val INDIVIDUAL_PLAYER_HTML = "<!doctypehtml><title>%s</title><link href=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css rel=stylesheet><script src=https://code.jquery.com/jquery-3.3.1.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js></script><script src=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.bundle.min.js></script><nav class=\"bg-light navbar navbar-expand-lg navbar-light rounded\"><button aria-controls=navbar aria-expanded=false aria-label=\"Toggle navigation\"class=\"collapsed navbar-toggler\"data-target=#navbar data-toggle=collapse type=button><span class=navbar-toggler-icon></span></button><div class=\"collapse navbar-collapse\"id=navbar><ul class=\"mr-auto navbar-nav\"><li class=\"nav-item active\"><a class=nav-link href=/ >Home</a><li class=nav-item><a class=nav-link href=/all_players>All Players</a><li class=nav-item><a class=nav-link href=/team_stats>Team Stats</a><li class=nav-item><a class=nav-link href=/position_stats>Position Stats</a><li class=nav-item><a class=nav-link href=/activity_check_query>Activity Check</a><li class=\"nav-item dropdown\"><a class=\"nav-link dropdown-toggle\"href=NSFL aria-expanded=false aria-haspopup=true data-toggle=dropdown id=nsfl>NSFL</a><div class=dropdown-menu aria-labelledby=nsfl><a class=dropdown-item href=/baltimore_hawks>Baltimore Hawks</a><a class=dropdown-item href=/chicago_butchers>Chicago Butchers</a><a class=dropdown-item href=/colorado_yeti>Colorado Yeti</a><a class=dropdown-item href=/philadelphia_liberty>Philadelphia Liberty</a><a class=dropdown-item href=/yellowknife_wraiths>Yellowknife Wraiths</a><a class=dropdown-item href=/arizona_outlaws>Arizona Outlaws</a><a class=dropdown-item href=/austin_copperheads>Austin Copperheads</a><a class=dropdown-item href=/new_orleans_second_line>New Orleans Second Line</a><a class=dropdown-item href=/orange_county_otters>Orange County Otters</a><a class=dropdown-item href=/san_jose_sabercats>San Jose SaberCats</a></div><li class=\"nav-item dropdown\"><a class=\"nav-link dropdown-toggle\"href=DSFL aria-expanded=false aria-haspopup=true data-toggle=dropdown id=dsfl>DSFL</a><div class=dropdown-menu aria-labelledby=dsfl><a class=dropdown-item href=/myrtle_beach_buccaneers>Myrtle Beach Buccaneers</a><a class=dropdown-item href=/dallas_birddogs>Dallas Birddogs</a><a class=dropdown-item href=/london_royals>London Royals</a><a class=dropdown-item href=/kansas_city_coyotes>Kansas City Coyotes</a><a class=dropdown-item href=/portland_pythons>Portland Pythons</a><a class=dropdown-item href=/norfolk_seawolves>Norfolk SeaWolves</a><a class=dropdown-item href=/minnesota_grey_ducks>Minnesota Grey Ducks</a><a class=dropdown-item href=/tijuana_luchadores>Tijuana Luchadores</a></div><li class=nav-item><a class=nav-link href=/free_agents>Free Agents</a><li class=\"nav-item dropdown\"><a class=\"nav-link dropdown-toggle\"href=Prospects aria-expanded=false aria-haspopup=true data-toggle=dropdown id=prospects>Prospects</a><div class=dropdown-menu aria-labelledby=prospects><a class=dropdown-item href=/qb_prospects>QB Prospects</a><a class=dropdown-item href=/rb_prospects>RB Prospects</a><a class=dropdown-item href=/wr_prospects>WR Prospects</a><a class=dropdown-item href=/te_prospects>TE Prospects</a><a class=dropdown-item href=/ol_prospects>OL Prospects</a><a class=dropdown-item href=/de_prospects>DE Prospects</a><a class=dropdown-item href=/dt_prospects>DT Prospects</a><a class=dropdown-item href=/lb_prospects>LB Prospects</a><a class=dropdown-item href=/cb_prospects>CB Prospects</a><a class=dropdown-item href=/s_prospects>S Prospects</a><a class=dropdown-item href=/kp_prospects>K/P Prospects</a></div><li class=nav-item><a class=nav-link href=/retired_players>Retired Players</a></ul></div></nav><div class=container><div><br><h2><a href=%s>%s</a></h2><h5><a href=%s>%s</a></h5><h7>%s</h7><br></div><div><canvas id=myChart></canvas></div></div><script>var ctx=document.getElementById('myChart'),myChart=new Chart(ctx,{type:'line',data:{labels:[%s],datasets:[{label:'TPE',lineTension:0,data:[%s]}]},options:{responsive:!0,title:{display:!0,text:'TPE History'},legend:{display:!1},tooltips:{mode:'index',intersect:!1,callbacks:{label:function(e){return e.yLabel}}},hover:{mode:'nearest',intersect:!0},scales:{yAxes:[{ticks:{min:0}}]}}});</script>"
private const val TEAM_STATS_HTML = "<!doctypehtml><title>Team Stats</title><link href=https://cdn.datatables.net/1.10.19/css/dataTables.bootstrap4.min.css rel=stylesheet><link href=https://cdn.datatables.net/buttons/1.5.6/css/buttons.bootstrap4.min.css rel=stylesheet><link href=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css rel=stylesheet><script src=https://code.jquery.com/jquery-3.3.1.js></script><script src=https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js></script><script src=https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap4.min.js></script><script src=https://cdn.datatables.net/buttons/1.5.6/js/dataTables.buttons.min.js></script><script src=https://cdn.datatables.net/buttons/1.5.6/js/buttons.bootstrap4.min.js></script><script src=https://cdn.datatables.net/buttons/1.5.6/js/buttons.colVis.min.js></script><script src=https://cdn.datatables.net/plug-ins/1.10.19/sorting/enum.js></script><script src=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.bundle.min.js></script><script class=init>var dataSet=[%s];\$(document).ready(function(){var t=\$(\"#table\").DataTable({dom:\"<'row'<'col-sm-6'B><'col-sm-6'f>><'row'<'col-sm-12'tr>><'row'<'col-sm-5'i><'col-sm-7'p>>\",scrollX:!0,paging:!1,order:[[0,\"desc\"]],buttons:[{text:\"Toggle All\",action:function(){t.columns().visible(!t.column(0).visible())}},{extend:'colvis',text:'Toggle Columns'}],data:dataSet,columns:[{title:\"League\"},{title:\"Name\"},{title:\"Total TPE\"},{title:\"Average TPE\"},{title:\"Total Effective TPE\"},{title:\"Average Effective TPE\"},{title:\"Offensive TPE\"},{title:\"Defensive TPE\"}]})});</script><style>td{white-space:nowrap;font-size:14px}th{white-space:nowrap;font-size:12px}.dataTables_info{font-size:14px}caption{padding-bottom:20px;caption-side:top}</style><nav class=\"bg-light navbar navbar-expand-lg navbar-light rounded\"><button aria-controls=navbar aria-expanded=false aria-label=\"Toggle navigation\"class=\"collapsed navbar-toggler\"data-target=#navbar data-toggle=collapse type=button><span class=navbar-toggler-icon></span></button><div class=\"collapse navbar-collapse\"id=navbar><ul class=\"mr-auto navbar-nav\"><li class=\"nav-item active\"><a class=nav-link href=/ >Home</a><li class=nav-item><a class=nav-link href=/all_players>All Players</a><li class=nav-item><a class=nav-link href=/team_stats>Team Stats</a><li class=nav-item><a class=nav-link href=/position_stats>Position Stats</a><li class=nav-item><a class=nav-link href=/activity_check_query>Activity Check</a><li class=\"nav-item dropdown\"><a class=\"nav-link dropdown-toggle\"href=NSFL aria-expanded=false aria-haspopup=true data-toggle=dropdown id=nsfl>NSFL</a><div class=dropdown-menu aria-labelledby=nsfl><a class=dropdown-item href=/baltimore_hawks>Baltimore Hawks</a><a class=dropdown-item href=/chicago_butchers>Chicago Butchers</a><a class=dropdown-item href=/colorado_yeti>Colorado Yeti</a><a class=dropdown-item href=/philadelphia_liberty>Philadelphia Liberty</a><a class=dropdown-item href=/yellowknife_wraiths>Yellowknife Wraiths</a><a class=dropdown-item href=/arizona_outlaws>Arizona Outlaws</a><a class=dropdown-item href=/austin_copperheads>Austin Copperheads</a><a class=dropdown-item href=/new_orleans_second_line>New Orleans Second Line</a><a class=dropdown-item href=/orange_county_otters>Orange County Otters</a><a class=dropdown-item href=/san_jose_sabercats>San Jose SaberCats</a></div><li class=\"nav-item dropdown\"><a class=\"nav-link dropdown-toggle\"href=DSFL aria-expanded=false aria-haspopup=true data-toggle=dropdown id=dsfl>DSFL</a><div class=dropdown-menu aria-labelledby=dsfl><a class=dropdown-item href=/myrtle_beach_buccaneers>Myrtle Beach Buccaneers</a><a class=dropdown-item href=/dallas_birddogs>Dallas Birddogs</a><a class=dropdown-item href=/london_royals>London Royals</a><a class=dropdown-item href=/kansas_city_coyotes>Kansas City Coyotes</a><a class=dropdown-item href=/portland_pythons>Portland Pythons</a><a class=dropdown-item href=/norfolk_seawolves>Norfolk SeaWolves</a><a class=dropdown-item href=/minnesota_grey_ducks>Minnesota Grey Ducks</a><a class=dropdown-item href=/tijuana_luchadores>Tijuana Luchadores</a></div><li class=nav-item><a class=nav-link href=/free_agents>Free Agents</a><li class=\"nav-item dropdown\"><a class=\"nav-link dropdown-toggle\"href=Prospects aria-expanded=false aria-haspopup=true data-toggle=dropdown id=prospects>Prospects</a><div class=dropdown-menu aria-labelledby=prospects><a class=dropdown-item href=/qb_prospects>QB Prospects</a><a class=dropdown-item href=/rb_prospects>RB Prospects</a><a class=dropdown-item href=/wr_prospects>WR Prospects</a><a class=dropdown-item href=/te_prospects>TE Prospects</a><a class=dropdown-item href=/ol_prospects>OL Prospects</a><a class=dropdown-item href=/de_prospects>DE Prospects</a><a class=dropdown-item href=/dt_prospects>DT Prospects</a><a class=dropdown-item href=/lb_prospects>LB Prospects</a><a class=dropdown-item href=/cb_prospects>CB Prospects</a><a class=dropdown-item href=/s_prospects>S Prospects</a><a class=dropdown-item href=/kp_prospects>K/P Prospects</a></div><li class=nav-item><a class=nav-link href=/retired_players>Retired Players</a></ul></div></nav><div style=padding-left:80px;padding-right:80px;padding-top:40px;padding-bottom:20px;color:rgba(0,0,0,.87);font-size:28px;text-align:center>Team Stats</div><div style=padding-left:80px;padding-right:80px;padding-top:20px;padding-bottom:40px><table class=\"celled table ui\"id=table width=100%%><caption></table></div>"
private const val POSITION_STATS_HTML = "<!doctypehtml><title>Position Stats</title><link href=https://cdn.datatables.net/1.10.19/css/dataTables.bootstrap4.min.css rel=stylesheet><link href=https://cdn.datatables.net/buttons/1.5.6/css/buttons.bootstrap4.min.css rel=stylesheet><link href=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css rel=stylesheet><script src=https://code.jquery.com/jquery-3.3.1.js></script><script src=https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js></script><script src=https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap4.min.js></script><script src=https://cdn.datatables.net/buttons/1.5.6/js/dataTables.buttons.min.js></script><script src=https://cdn.datatables.net/buttons/1.5.6/js/buttons.bootstrap4.min.js></script><script src=https://cdn.datatables.net/buttons/1.5.6/js/buttons.colVis.min.js></script><script src=https://cdn.datatables.net/plug-ins/1.10.19/sorting/enum.js></script><script src=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.bundle.min.js></script><script class=init>var dataSet=[%s];\$(document).ready(function(){\$.fn.dataTable.enum([\"Quarterback\",\"Running Back\",\"Wide Receiver\",\"Tight End\",\"Offensive Line\",\"Defensive End\",\"Defensive Tackle\",\"Linebacker\",\"Cornerback\",\"Safety\",\"Kicker/Punter\",\"Unknown\"]);var t=\$(\"#table\").DataTable({dom:\"<'row'<'col-sm-6'B><'col-sm-6'f>><'row'<'col-sm-12'tr>><'row'<'col-sm-5'i><'col-sm-7'p>>\",scrollX:!0,paging:!1,order:[[0,\"asc\"]],buttons:[{text:\"Toggle All\",action:function(){t.columns().visible(!t.column(0).visible())}},{extend:'colvis',text:'Toggle Columns'}],data:dataSet,columns:[{title:\"Position\"},{title:\"NSFL\"},{title:\"DSFL\"},{title:\"Free Agents\"},{title:\"Prospects\"},{title:\"Total\"},{title:\"NSFL Min TPE\"},{title:\"NSFL Max TPE\"},{title:\"NSFL Average TPE\"},{title:\"DSFL Min TPE\"},{title:\"DSFL Max TPE\"},{title:\"DSFL Average TPE\"}]})});</script><style>td{white-space:nowrap;font-size:14px}th{white-space:nowrap;font-size:12px}.dataTables_info{font-size:14px}caption{padding-bottom:20px;caption-side:top}</style><nav class=\"bg-light navbar navbar-expand-lg navbar-light rounded\"><button aria-controls=navbar aria-expanded=false aria-label=\"Toggle navigation\"class=\"collapsed navbar-toggler\"data-target=#navbar data-toggle=collapse type=button><span class=navbar-toggler-icon></span></button><div class=\"collapse navbar-collapse\"id=navbar><ul class=\"mr-auto navbar-nav\"><li class=\"nav-item active\"><a class=nav-link href=/ >Home</a><li class=nav-item><a class=nav-link href=/all_players>All Players</a><li class=nav-item><a class=nav-link href=/team_stats>Team Stats</a><li class=nav-item><a class=nav-link href=/position_stats>Position Stats</a><li class=nav-item><a class=nav-link href=/activity_check_query>Activity Check</a><li class=\"nav-item dropdown\"><a class=\"nav-link dropdown-toggle\"href=NSFL aria-expanded=false aria-haspopup=true data-toggle=dropdown id=nsfl>NSFL</a><div class=dropdown-menu aria-labelledby=nsfl><a class=dropdown-item href=/baltimore_hawks>Baltimore Hawks</a><a class=dropdown-item href=/chicago_butchers>Chicago Butchers</a><a class=dropdown-item href=/colorado_yeti>Colorado Yeti</a><a class=dropdown-item href=/philadelphia_liberty>Philadelphia Liberty</a><a class=dropdown-item href=/yellowknife_wraiths>Yellowknife Wraiths</a><a class=dropdown-item href=/arizona_outlaws>Arizona Outlaws</a><a class=dropdown-item href=/austin_copperheads>Austin Copperheads</a><a class=dropdown-item href=/new_orleans_second_line>New Orleans Second Line</a><a class=dropdown-item href=/orange_county_otters>Orange County Otters</a><a class=dropdown-item href=/san_jose_sabercats>San Jose SaberCats</a></div><li class=\"nav-item dropdown\"><a class=\"nav-link dropdown-toggle\"href=DSFL aria-expanded=false aria-haspopup=true data-toggle=dropdown id=dsfl>DSFL</a><div class=dropdown-menu aria-labelledby=dsfl><a class=dropdown-item href=/myrtle_beach_buccaneers>Myrtle Beach Buccaneers</a><a class=dropdown-item href=/dallas_birddogs>Dallas Birddogs</a><a class=dropdown-item href=/london_royals>London Royals</a><a class=dropdown-item href=/kansas_city_coyotes>Kansas City Coyotes</a><a class=dropdown-item href=/portland_pythons>Portland Pythons</a><a class=dropdown-item href=/norfolk_seawolves>Norfolk SeaWolves</a><a class=dropdown-item href=/minnesota_grey_ducks>Minnesota Grey Ducks</a><a class=dropdown-item href=/tijuana_luchadores>Tijuana Luchadores</a></div><li class=nav-item><a class=nav-link href=/free_agents>Free Agents</a><li class=\"nav-item dropdown\"><a class=\"nav-link dropdown-toggle\"href=Prospects aria-expanded=false aria-haspopup=true data-toggle=dropdown id=prospects>Prospects</a><div class=dropdown-menu aria-labelledby=prospects><a class=dropdown-item href=/qb_prospects>QB Prospects</a><a class=dropdown-item href=/rb_prospects>RB Prospects</a><a class=dropdown-item href=/wr_prospects>WR Prospects</a><a class=dropdown-item href=/te_prospects>TE Prospects</a><a class=dropdown-item href=/ol_prospects>OL Prospects</a><a class=dropdown-item href=/de_prospects>DE Prospects</a><a class=dropdown-item href=/dt_prospects>DT Prospects</a><a class=dropdown-item href=/lb_prospects>LB Prospects</a><a class=dropdown-item href=/cb_prospects>CB Prospects</a><a class=dropdown-item href=/s_prospects>S Prospects</a><a class=dropdown-item href=/kp_prospects>K/P Prospects</a></div><li class=nav-item><a class=nav-link href=/retired_players>Retired Players</a></ul></div></nav><div style=padding-left:80px;padding-right:80px;padding-top:40px;padding-bottom:20px;color:rgba(0,0,0,.87);font-size:28px;text-align:center>Position Stats</div><div style=padding-left:80px;padding-right:80px;padding-top:20px;padding-bottom:40px><table class=\"celled table ui\"id=table width=100%%><caption></table></div>"
private const val ACTIVITY_CHECK_QUERY_HTML = "<!doctypehtml><title>Activity Check</title><link href=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css rel=stylesheet> <script src=https://code.jquery.com/jquery-3.3.1.js></script><script src=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.bundle.min.js></script> <style>.page-wrap{min-height:80vh}</style><nav class=\"bg-light navbar navbar-expand-lg navbar-light rounded\"> <button aria-controls=navbar aria-expanded=false aria-label=\"Toggle navigation\"class=\"collapsed navbar-toggler\"data-target=#navbar data-toggle=collapse type=button><span class=navbar-toggler-icon></span></button><div class=\"collapse navbar-collapse\"id=navbar><ul class=\"mr-auto navbar-nav\"><li class=\"nav-item active\"><a class=nav-link href=/ >Home</a><li class=nav-item><a class=nav-link href=/all_players>All Players</a><li class=nav-item><a class=nav-link href=/team_stats>Team Stats</a><li class=nav-item><a class=nav-link href=/position_stats>Position Stats</a><li class=nav-item><a class=nav-link href=/activity_check_query>Activity Check</a><li class=\"nav-item dropdown\"> <a class=\"nav-link dropdown-toggle\"href=NSFL aria-expanded=false aria-haspopup=true data-toggle=dropdown id=nsfl>NSFL</a><div class=dropdown-menu aria-labelledby=nsfl><a class=dropdown-item href=/baltimore_hawks>Baltimore Hawks</a><a class=dropdown-item href=/chicago_butchers>Chicago Butchers</a><a class=dropdown-item href=/colorado_yeti>Colorado Yeti</a><a class=dropdown-item href=/philadelphia_liberty>Philadelphia Liberty</a><a class=dropdown-item href=/yellowknife_wraiths>Yellowknife Wraiths</a><a class=dropdown-item href=/arizona_outlaws>Arizona Outlaws</a><a class=dropdown-item href=/austin_copperheads>Austin Copperheads</a><a class=dropdown-item href=/new_orleans_second_line>New Orleans Second Line</a><a class=dropdown-item href=/orange_county_otters>Orange County Otters</a><a class=dropdown-item href=/san_jose_sabercats>San Jose SaberCats</a></div><li class=\"nav-item dropdown\"> <a class=\"nav-link dropdown-toggle\"href=DSFL aria-expanded=false aria-haspopup=true data-toggle=dropdown id=dsfl>DSFL</a><div class=dropdown-menu aria-labelledby=dsfl><a class=dropdown-item href=/myrtle_beach_buccaneers>Myrtle Beach Buccaneers</a><a class=dropdown-item href=/dallas_birddogs>Dallas Birddogs</a><a class=dropdown-item href=/london_royals>London Royals</a><a class=dropdown-item href=/kansas_city_coyotes>Kansas City Coyotes</a><a class=dropdown-item href=/portland_pythons>Portland Pythons</a><a class=dropdown-item href=/norfolk_seawolves>Norfolk SeaWolves</a><a class=dropdown-item href=/minnesota_grey_ducks>Minnesota Grey Ducks</a><a class=dropdown-item href=/tijuana_luchadores>Tijuana Luchadores</a></div><li class=nav-item><a class=nav-link href=/free_agents>Free Agents</a><li class=\"nav-item dropdown\"> <a class=\"nav-link dropdown-toggle\"href=Prospects aria-expanded=false aria-haspopup=true data-toggle=dropdown id=prospects>Prospects</a><div class=dropdown-menu aria-labelledby=prospects><a class=dropdown-item href=/qb_prospects>QB Prospects</a><a class=dropdown-item href=/rb_prospects>RB Prospects</a><a class=dropdown-item href=/wr_prospects>WR Prospects</a><a class=dropdown-item href=/te_prospects>TE Prospects</a><a class=dropdown-item href=/ol_prospects>OL Prospects</a><a class=dropdown-item href=/de_prospects>DE Prospects</a><a class=dropdown-item href=/dt_prospects>DT Prospects</a><a class=dropdown-item href=/lb_prospects>LB Prospects</a><a class=dropdown-item href=/cb_prospects>CB Prospects</a><a class=dropdown-item href=/s_prospects>S Prospects</a><a class=dropdown-item href=/kp_prospects>K/P Prospects</a></div><li class=nav-item><a class=nav-link href=/retired_players>Retired Players</a></ul></div> </nav><div><div class=\"align-items-center d-flex flex-row page-wrap\"><div class=container><div class=\"justify-content-center row\"><div class=\"col-md-12 text-center\"><span class=\"d-block mb-4 display-4\">Activity Check</span><form action=/activity_check_result>Start Date<br><input name=startDate type=date><br><br>End Date<br><input name=endDate type=date><br><br><input type=submit></form></div></div></div></div></div>"
private const val ACTIVITY_CHECK_RESULT_HTML = "<!doctypehtml><title>Activity Check</title><link href=https://cdn.datatables.net/1.10.19/css/dataTables.bootstrap4.min.css rel=stylesheet><link href=https://cdn.datatables.net/buttons/1.5.6/css/buttons.bootstrap4.min.css rel=stylesheet><link href=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css rel=stylesheet> <script src=https://code.jquery.com/jquery-3.3.1.js></script><script src=https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js></script><script src=https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap4.min.js></script><script src=https://cdn.datatables.net/buttons/1.5.6/js/dataTables.buttons.min.js></script><script src=https://cdn.datatables.net/buttons/1.5.6/js/buttons.bootstrap4.min.js></script><script src=https://cdn.datatables.net/buttons/1.5.6/js/buttons.colVis.min.js></script><script src=https://cdn.datatables.net/plug-ins/1.10.19/sorting/enum.js></script><script src=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.bundle.min.js></script><script class=init>var dataSet=[%s];\$(document).ready(function(){var t=\$(\"#table\").DataTable({dom:\"<'row'<'col-sm-6'B><'col-sm-6'f>><'row'<'col-sm-12'tr>><'row'<'col-sm-5'i><'col-sm-7'p>>\",scrollX:!0,paging:!1,order:[[7,\"desc\"]],buttons:[{text:\"Toggle All\",action:function(){t.columns().visible(!t.column(0).visible())}},{extend:'colvis',text:'Toggle Columns'}],data:dataSet,columns:[{title:\"User\"},{title:\"Draft Year\"},{title:\"Team\"},{title:\"Name\"},{title:\"Position\"},{title:\"TPE Gained\"},{title:\"TPE Lost\"},{title:\"TPE Difference\"},{title:\"Current TPE\"},{title:\"Highest TPE\"},{title:\"Last Updated\"},{title:\"Last Seen\"}]})});</script> <style>td{white-space:nowrap;font-size:14px}th{white-space:nowrap;font-size:12px}.dataTables_info{font-size:14px}caption{padding-bottom:20px;caption-side:top}</style><nav class=\"bg-light navbar navbar-expand-lg navbar-light rounded\"> <button aria-controls=navbar aria-expanded=false aria-label=\"Toggle navigation\"class=\"collapsed navbar-toggler\"data-target=#navbar data-toggle=collapse type=button><span class=navbar-toggler-icon></span></button><div class=\"collapse navbar-collapse\"id=navbar><ul class=\"mr-auto navbar-nav\"><li class=\"nav-item active\"><a class=nav-link href=/ >Home</a><li class=nav-item><a class=nav-link href=/all_players>All Players</a><li class=nav-item><a class=nav-link href=/team_stats>Team Stats</a><li class=nav-item><a class=nav-link href=/position_stats>Position Stats</a><li class=nav-item><a class=nav-link href=/activity_check_query>Activity Check</a><li class=\"nav-item dropdown\"> <a class=\"nav-link dropdown-toggle\"href=NSFL aria-expanded=false aria-haspopup=true data-toggle=dropdown id=nsfl>NSFL</a><div class=dropdown-menu aria-labelledby=nsfl><a class=dropdown-item href=/baltimore_hawks>Baltimore Hawks</a><a class=dropdown-item href=/chicago_butchers>Chicago Butchers</a><a class=dropdown-item href=/colorado_yeti>Colorado Yeti</a><a class=dropdown-item href=/philadelphia_liberty>Philadelphia Liberty</a><a class=dropdown-item href=/yellowknife_wraiths>Yellowknife Wraiths</a><a class=dropdown-item href=/arizona_outlaws>Arizona Outlaws</a><a class=dropdown-item href=/austin_copperheads>Austin Copperheads</a><a class=dropdown-item href=/new_orleans_second_line>New Orleans Second Line</a><a class=dropdown-item href=/orange_county_otters>Orange County Otters</a><a class=dropdown-item href=/san_jose_sabercats>San Jose SaberCats</a></div><li class=\"nav-item dropdown\"> <a class=\"nav-link dropdown-toggle\"href=DSFL aria-expanded=false aria-haspopup=true data-toggle=dropdown id=dsfl>DSFL</a><div class=dropdown-menu aria-labelledby=dsfl><a class=dropdown-item href=/myrtle_beach_buccaneers>Myrtle Beach Buccaneers</a><a class=dropdown-item href=/dallas_birddogs>Dallas Birddogs</a><a class=dropdown-item href=/london_royals>London Royals</a><a class=dropdown-item href=/kansas_city_coyotes>Kansas City Coyotes</a><a class=dropdown-item href=/portland_pythons>Portland Pythons</a><a class=dropdown-item href=/norfolk_seawolves>Norfolk SeaWolves</a><a class=dropdown-item href=/minnesota_grey_ducks>Minnesota Grey Ducks</a><a class=dropdown-item href=/tijuana_luchadores>Tijuana Luchadores</a></div><li class=nav-item><a class=nav-link href=/free_agents>Free Agents</a><li class=\"nav-item dropdown\"> <a class=\"nav-link dropdown-toggle\"href=Prospects aria-expanded=false aria-haspopup=true data-toggle=dropdown id=prospects>Prospects</a><div class=dropdown-menu aria-labelledby=prospects><a class=dropdown-item href=/qb_prospects>QB Prospects</a><a class=dropdown-item href=/rb_prospects>RB Prospects</a><a class=dropdown-item href=/wr_prospects>WR Prospects</a><a class=dropdown-item href=/te_prospects>TE Prospects</a><a class=dropdown-item href=/ol_prospects>OL Prospects</a><a class=dropdown-item href=/de_prospects>DE Prospects</a><a class=dropdown-item href=/dt_prospects>DT Prospects</a><a class=dropdown-item href=/lb_prospects>LB Prospects</a><a class=dropdown-item href=/cb_prospects>CB Prospects</a><a class=dropdown-item href=/s_prospects>S Prospects</a><a class=dropdown-item href=/kp_prospects>K/P Prospects</a></div><li class=nav-item><a class=nav-link href=/retired_players>Retired Players</a></ul></div> </nav><div style=padding-left:80px;padding-right:80px;padding-top:40px;padding-bottom:20px;color:rgba(0,0,0,.87);font-size:28px;text-align:center>%s</div><div style=padding-left:80px;padding-right:80px;padding-top:20px;padding-bottom:40px><table class=\"celled table ui\"id=table width=100%%><caption></table></div>"
private const val INDIVIDUAL_TEAM_HTML = "<!doctypehtml><title>%s</title><link href=https://cdn.datatables.net/1.10.19/css/dataTables.bootstrap4.min.css rel=stylesheet><link href=https://cdn.datatables.net/buttons/1.5.6/css/buttons.bootstrap4.min.css rel=stylesheet><link href=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css rel=stylesheet><script src=https://code.jquery.com/jquery-3.3.1.js></script><script src=https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js></script><script src=https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap4.min.js></script><script src=https://cdn.datatables.net/buttons/1.5.6/js/dataTables.buttons.min.js></script><script src=https://cdn.datatables.net/buttons/1.5.6/js/buttons.bootstrap4.min.js></script><script src=https://cdn.datatables.net/buttons/1.5.6/js/buttons.colVis.min.js></script><script src=https://cdn.datatables.net/plug-ins/1.10.19/sorting/enum.js></script><script src=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.bundle.min.js></script><script class=init>var dataSet=[%s];\$(document).ready(function(){\$.fn.dataTable.enum([\"Quarterback\",\"Running Back\",\"Wide Receiver\",\"Tight End\",\"Offensive Line\",\"Defensive End\",\"Defensive Tackle\",\"Linebacker\",\"Cornerback\",\"Safety\",\"Kicker/Punter\",\"Unknown\"]);var t=\$(\"#table\").DataTable({dom:\"<'row'<'col-sm-6'B><'col-sm-6'f>><'row'<'col-sm-12'tr>><'row'<'col-sm-5'i><'col-sm-7'p>>\",scrollX:!0,paging:!1,order:[[4,\"desc\"]],buttons:[{text:\"Toggle All\",action:function(){t.columns().visible(!t.column(0).visible())}},{text:\"Toggle Attributes\",action:function(){t.columns([8,9,10,11,12,13,14,15,16,17,18,19,20]).visible(!t.column(8).visible())}},{extend:'colvis',text:'Toggle Columns'}],data:dataSet,columns:[{title:\"User\"},{title:\"Draft Year\"},{title:\"Name\"},{title:\"Position\"},{title:\"Current TPE\"},{title:\"Highest TPE\"},{title:\"Last Updated\"},{title:\"Last Seen\"},{title:\"Str\"},{title:\"Agi\"},{title:\"Arm\"},{title:\"Int\"},{title:\"Thr\"},{title:\"Tck\"},{title:\"Spd\"},{title:\"Hnd\"},{title:\"PBlk\"},{title:\"RBlk\"},{title:\"End\"},{title:\"KPow\"},{title:\"KAcc\"}]})});</script><style>td{white-space:nowrap;font-size:14px}th{white-space:nowrap;font-size:12px}.dataTables_info{font-size:14px}caption{padding-bottom:20px;caption-side:top}</style><nav class=\"bg-light navbar navbar-expand-lg navbar-light rounded\"><button aria-controls=navbar aria-expanded=false aria-label=\"Toggle navigation\"class=\"collapsed navbar-toggler\"data-target=#navbar data-toggle=collapse type=button><span class=navbar-toggler-icon></span></button><div class=\"collapse navbar-collapse\"id=navbar><ul class=\"mr-auto navbar-nav\"><li class=\"nav-item active\"><a class=nav-link href=/ >Home</a><li class=nav-item><a class=nav-link href=/all_players>All Players</a><li class=nav-item><a class=nav-link href=/team_stats>Team Stats</a><li class=nav-item><a class=nav-link href=/position_stats>Position Stats</a><li class=nav-item><a class=nav-link href=/activity_check_query>Activity Check</a><li class=\"nav-item dropdown\"><a class=\"nav-link dropdown-toggle\"href=NSFL aria-expanded=false aria-haspopup=true data-toggle=dropdown id=nsfl>NSFL</a><div class=dropdown-menu aria-labelledby=nsfl><a class=dropdown-item href=/baltimore_hawks>Baltimore Hawks</a><a class=dropdown-item href=/chicago_butchers>Chicago Butchers</a><a class=dropdown-item href=/colorado_yeti>Colorado Yeti</a><a class=dropdown-item href=/philadelphia_liberty>Philadelphia Liberty</a><a class=dropdown-item href=/yellowknife_wraiths>Yellowknife Wraiths</a><a class=dropdown-item href=/arizona_outlaws>Arizona Outlaws</a><a class=dropdown-item href=/austin_copperheads>Austin Copperheads</a><a class=dropdown-item href=/new_orleans_second_line>New Orleans Second Line</a><a class=dropdown-item href=/orange_county_otters>Orange County Otters</a><a class=dropdown-item href=/san_jose_sabercats>San Jose SaberCats</a></div><li class=\"nav-item dropdown\"><a class=\"nav-link dropdown-toggle\"href=DSFL aria-expanded=false aria-haspopup=true data-toggle=dropdown id=dsfl>DSFL</a><div class=dropdown-menu aria-labelledby=dsfl><a class=dropdown-item href=/myrtle_beach_buccaneers>Myrtle Beach Buccaneers</a><a class=dropdown-item href=/dallas_birddogs>Dallas Birddogs</a><a class=dropdown-item href=/london_royals>London Royals</a><a class=dropdown-item href=/kansas_city_coyotes>Kansas City Coyotes</a><a class=dropdown-item href=/portland_pythons>Portland Pythons</a><a class=dropdown-item href=/norfolk_seawolves>Norfolk SeaWolves</a><a class=dropdown-item href=/minnesota_grey_ducks>Minnesota Grey Ducks</a><a class=dropdown-item href=/tijuana_luchadores>Tijuana Luchadores</a></div><li class=nav-item><a class=nav-link href=/free_agents>Free Agents</a><li class=\"nav-item dropdown\"><a class=\"nav-link dropdown-toggle\"href=Prospects aria-expanded=false aria-haspopup=true data-toggle=dropdown id=prospects>Prospects</a><div class=dropdown-menu aria-labelledby=prospects><a class=dropdown-item href=/qb_prospects>QB Prospects</a><a class=dropdown-item href=/rb_prospects>RB Prospects</a><a class=dropdown-item href=/wr_prospects>WR Prospects</a><a class=dropdown-item href=/te_prospects>TE Prospects</a><a class=dropdown-item href=/ol_prospects>OL Prospects</a><a class=dropdown-item href=/de_prospects>DE Prospects</a><a class=dropdown-item href=/dt_prospects>DT Prospects</a><a class=dropdown-item href=/lb_prospects>LB Prospects</a><a class=dropdown-item href=/cb_prospects>CB Prospects</a><a class=dropdown-item href=/s_prospects>S Prospects</a><a class=dropdown-item href=/kp_prospects>K/P Prospects</a></div><li class=nav-item><a class=nav-link href=/retired_players>Retired Players</a></ul></div></nav><div style=padding-left:80px;padding-right:80px;padding-top:40px;padding-bottom:20px;color:rgba(0,0,0,.87);font-size:28px;text-align:center>%s</div><div style=padding-left:80px;padding-right:80px;padding-top:20px;padding-bottom:40px><table class=\"celled table ui\"id=table width=100%%><caption></table></div>"
private const val RETIRED_PLAYERS_HTML = "<!doctypehtml><title>Retired Players</title><link href=https://cdn.datatables.net/1.10.19/css/dataTables.bootstrap4.min.css rel=stylesheet><link href=https://cdn.datatables.net/buttons/1.5.6/css/buttons.bootstrap4.min.css rel=stylesheet><link href=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css rel=stylesheet><script src=https://code.jquery.com/jquery-3.3.1.js></script><script src=https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js></script><script src=https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap4.min.js></script><script src=https://cdn.datatables.net/buttons/1.5.6/js/dataTables.buttons.min.js></script><script src=https://cdn.datatables.net/buttons/1.5.6/js/buttons.bootstrap4.min.js></script><script src=https://cdn.datatables.net/buttons/1.5.6/js/buttons.colVis.min.js></script><script src=https://cdn.datatables.net/plug-ins/1.10.19/sorting/enum.js></script><script src=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.bundle.min.js></script><script class=init>var dataSet=[%s];\$(document).ready(function(){\$.fn.dataTable.enum([\"Quarterback\",\"Running Back\",\"Wide Receiver\",\"Tight End\",\"Offensive Line\",\"Defensive End\",\"Defensive Tackle\",\"Linebacker\",\"Cornerback\",\"Safety\",\"Kicker/Punter\",\"Unknown\"]);var t=\$(\"#table\").DataTable({dom:\"<'row'<'col-sm-6'B><'col-sm-6'f>><'row'<'col-sm-12'tr>><'row'<'col-sm-5'i><'col-sm-7'p>>\",scrollX:!0,paging:!1,order:[[5,\"desc\"]],buttons:[{text:\"Toggle All\",action:function(){t.columns().visible(!t.column(0).visible())}},{extend:'colvis',text:'Toggle Columns'}],data:dataSet,columns:[{title:\"Draft Year\"},{title:\"Team\"},{title:\"Name\"},{title:\"Position\"},{title:\"Current TPE\"},{title:\"Highest TPE\"},{title:\"Last Updated\"}]})});</script><style>td{white-space:nowrap;font-size:14px}th{white-space:nowrap;font-size:12px}.dataTables_info{font-size:14px}caption{padding-bottom:20px;caption-side:top}</style><nav class=\"bg-light navbar navbar-expand-lg navbar-light rounded\"><button aria-controls=navbar aria-expanded=false aria-label=\"Toggle navigation\"class=\"collapsed navbar-toggler\"data-target=#navbar data-toggle=collapse type=button><span class=navbar-toggler-icon></span></button><div class=\"collapse navbar-collapse\"id=navbar><ul class=\"mr-auto navbar-nav\"><li class=\"nav-item active\"><a class=nav-link href=/ >Home</a><li class=nav-item><a class=nav-link href=/all_players>All Players</a><li class=nav-item><a class=nav-link href=/team_stats>Team Stats</a><li class=nav-item><a class=nav-link href=/position_stats>Position Stats</a><li class=nav-item><a class=nav-link href=/activity_check_query>Activity Check</a><li class=\"nav-item dropdown\"><a class=\"nav-link dropdown-toggle\"href=NSFL aria-expanded=false aria-haspopup=true data-toggle=dropdown id=nsfl>NSFL</a><div class=dropdown-menu aria-labelledby=nsfl><a class=dropdown-item href=/baltimore_hawks>Baltimore Hawks</a><a class=dropdown-item href=/chicago_butchers>Chicago Butchers</a><a class=dropdown-item href=/colorado_yeti>Colorado Yeti</a><a class=dropdown-item href=/philadelphia_liberty>Philadelphia Liberty</a><a class=dropdown-item href=/yellowknife_wraiths>Yellowknife Wraiths</a><a class=dropdown-item href=/arizona_outlaws>Arizona Outlaws</a><a class=dropdown-item href=/austin_copperheads>Austin Copperheads</a><a class=dropdown-item href=/new_orleans_second_line>New Orleans Second Line</a><a class=dropdown-item href=/orange_county_otters>Orange County Otters</a><a class=dropdown-item href=/san_jose_sabercats>San Jose SaberCats</a></div><li class=\"nav-item dropdown\"><a class=\"nav-link dropdown-toggle\"href=DSFL aria-expanded=false aria-haspopup=true data-toggle=dropdown id=dsfl>DSFL</a><div class=dropdown-menu aria-labelledby=dsfl><a class=dropdown-item href=/myrtle_beach_buccaneers>Myrtle Beach Buccaneers</a><a class=dropdown-item href=/dallas_birddogs>Dallas Birddogs</a><a class=dropdown-item href=/london_royals>London Royals</a><a class=dropdown-item href=/kansas_city_coyotes>Kansas City Coyotes</a><a class=dropdown-item href=/portland_pythons>Portland Pythons</a><a class=dropdown-item href=/norfolk_seawolves>Norfolk SeaWolves</a><a class=dropdown-item href=/minnesota_grey_ducks>Minnesota Grey Ducks</a><a class=dropdown-item href=/tijuana_luchadores>Tijuana Luchadores</a></div><li class=nav-item><a class=nav-link href=/free_agents>Free Agents</a><li class=\"nav-item dropdown\"><a class=\"nav-link dropdown-toggle\"href=Prospects aria-expanded=false aria-haspopup=true data-toggle=dropdown id=prospects>Prospects</a><div class=dropdown-menu aria-labelledby=prospects><a class=dropdown-item href=/qb_prospects>QB Prospects</a><a class=dropdown-item href=/rb_prospects>RB Prospects</a><a class=dropdown-item href=/wr_prospects>WR Prospects</a><a class=dropdown-item href=/te_prospects>TE Prospects</a><a class=dropdown-item href=/ol_prospects>OL Prospects</a><a class=dropdown-item href=/de_prospects>DE Prospects</a><a class=dropdown-item href=/dt_prospects>DT Prospects</a><a class=dropdown-item href=/lb_prospects>LB Prospects</a><a class=dropdown-item href=/cb_prospects>CB Prospects</a><a class=dropdown-item href=/s_prospects>S Prospects</a><a class=dropdown-item href=/kp_prospects>K/P Prospects</a></div><li class=nav-item><a class=nav-link href=/retired_players>Retired Players</a></ul></div></nav><div style=padding-left:80px;padding-right:80px;padding-top:40px;padding-bottom:20px;color:rgba(0,0,0,.87);font-size:28px;text-align:center>Retired Players</div><div style=padding-left:80px;padding-right:80px;padding-top:20px;padding-bottom:40px><table class=\"celled table ui\"id=table width=100%%><caption></table></div>"
private const val ERROR_HTML = "<!doctypehtml><title>Whoopsies</title><link href=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css rel=stylesheet><script src=https://code.jquery.com/jquery-3.3.1.js></script><script src=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.bundle.min.js></script><style>.page-wrap{min-height:80vh}</style><nav class=\"bg-light navbar navbar-expand-lg navbar-light rounded\"><button aria-controls=navbar aria-expanded=false aria-label=\"Toggle navigation\"class=\"collapsed navbar-toggler\"data-target=#navbar data-toggle=collapse type=button><span class=navbar-toggler-icon></span></button><div class=\"collapse navbar-collapse\"id=navbar><ul class=\"mr-auto navbar-nav\"><li class=\"nav-item active\"><a class=nav-link href=/ >Home</a><li class=nav-item><a class=nav-link href=/all_players>All Players</a><li class=nav-item><a class=nav-link href=/team_stats>Team Stats</a><li class=nav-item><a class=nav-link href=/position_stats>Position Stats</a><li class=nav-item><a class=nav-link href=/activity_check_query>Activity Check</a><li class=\"nav-item dropdown\"><a class=\"nav-link dropdown-toggle\"href=NSFL aria-expanded=false aria-haspopup=true data-toggle=dropdown id=nsfl>NSFL</a><div class=dropdown-menu aria-labelledby=nsfl><a class=dropdown-item href=/baltimore_hawks>Baltimore Hawks</a><a class=dropdown-item href=/chicago_butchers>Chicago Butchers</a><a class=dropdown-item href=/colorado_yeti>Colorado Yeti</a><a class=dropdown-item href=/philadelphia_liberty>Philadelphia Liberty</a><a class=dropdown-item href=/yellowknife_wraiths>Yellowknife Wraiths</a><a class=dropdown-item href=/arizona_outlaws>Arizona Outlaws</a><a class=dropdown-item href=/austin_copperheads>Austin Copperheads</a><a class=dropdown-item href=/new_orleans_second_line>New Orleans Second Line</a><a class=dropdown-item href=/orange_county_otters>Orange County Otters</a><a class=dropdown-item href=/san_jose_sabercats>San Jose SaberCats</a></div><li class=\"nav-item dropdown\"><a class=\"nav-link dropdown-toggle\"href=DSFL aria-expanded=false aria-haspopup=true data-toggle=dropdown id=dsfl>DSFL</a><div class=dropdown-menu aria-labelledby=dsfl><a class=dropdown-item href=/myrtle_beach_buccaneers>Myrtle Beach Buccaneers</a><a class=dropdown-item href=/dallas_birddogs>Dallas Birddogs</a><a class=dropdown-item href=/london_royals>London Royals</a><a class=dropdown-item href=/kansas_city_coyotes>Kansas City Coyotes</a><a class=dropdown-item href=/portland_pythons>Portland Pythons</a><a class=dropdown-item href=/norfolk_seawolves>Norfolk SeaWolves</a><a class=dropdown-item href=/minnesota_grey_ducks>Minnesota Grey Ducks</a><a class=dropdown-item href=/tijuana_luchadores>Tijuana Luchadores</a></div><li class=nav-item><a class=nav-link href=/free_agents>Free Agents</a><li class=\"nav-item dropdown\"><a class=\"nav-link dropdown-toggle\"href=Prospects aria-expanded=false aria-haspopup=true data-toggle=dropdown id=prospects>Prospects</a><div class=dropdown-menu aria-labelledby=prospects><a class=dropdown-item href=/qb_prospects>QB Prospects</a><a class=dropdown-item href=/rb_prospects>RB Prospects</a><a class=dropdown-item href=/wr_prospects>WR Prospects</a><a class=dropdown-item href=/te_prospects>TE Prospects</a><a class=dropdown-item href=/ol_prospects>OL Prospects</a><a class=dropdown-item href=/de_prospects>DE Prospects</a><a class=dropdown-item href=/dt_prospects>DT Prospects</a><a class=dropdown-item href=/lb_prospects>LB Prospects</a><a class=dropdown-item href=/cb_prospects>CB Prospects</a><a class=dropdown-item href=/s_prospects>S Prospects</a><a class=dropdown-item href=/kp_prospects>K/P Prospects</a></div><li class=nav-item><a class=nav-link href=/retired_players>Retired Players</a></ul></div></nav><div><div class=\"align-items-center d-flex flex-row page-wrap\"><div class=container><div class=\"justify-content-center row\"><div class=\"col-md-12 text-center\"><span class=\"d-block mb-4 display-2\">%s</span><span class=\"d-block mb-4 display-11\">%s</span><a class=\"btn btn-link\"href=/random_pasta>Hit me!</a></div></div></div></div></div>"

class HTMLGenerator {

    private val inputDateFormat = SimpleDateFormat("yyyy-MM-dd")
    private val playerDateFormat = SimpleDateFormat("MM/dd/yyyy")

    fun createIndexPage() = INDEX_HTML

    fun createAllPlayersPage(
            playerList: List<ActivePlayer>
    ) = ALL_PLAYERS_HTML.format(
            playerList.joinToString(",") {
                "['<a href=\"http://nsfl.jcink.net/index.php?showtopic=${it.id}\">${it.user}</a>','${it.draftYear}','<a href=\"${it.team.url}\">${it.team.full}</a>','<a href=\"/player?playerId=${it.id}\">${it.name}</a>','${it.position.full}','${it.currentTPE}','${it.highestTPE}','${it.lastUpdated}','${it.lastSeen}','${it.strength}','${it.agility}','${it.arm}','${it.intelligence}','${it.throwingAccuracy}','${it.tackling}','${it.speed}','${it.hands}','${it.passBlocking}','${it.runBlocking}','${it.endurance}','${it.kickPower}','${it.kickAccuracy}']"
            }
    )

    fun createPlayerPage(
            player: Player
    ) = INDIVIDUAL_PLAYER_HTML.format(
            player.name,
            "http://nsfl.jcink.net/index.php?showtopic=${player.id}",
            player.name,
            player.team.url,
            player.team.full,
            "${player.position.full} - ${player.draftYear}",
            player.tpeHistoryList.joinToString(",") {
                if (it.first.isEmpty()) {
                    "'${it.first}'"
                } else {
                    "'${it.first.substring(0, 5)}'"
                }
            },
            player.tpeHistoryList.joinToString(",") {
                "'${it.second}'"
            }
    )

    fun createTeamStatsPage(
            nsflList: List<Pair<Team, List<ActivePlayer>>>,
            dsflList: List<Pair<Team, List<ActivePlayer>>>
    ) = TEAM_STATS_HTML.format(
            nsflList.joinToString(",") { pair ->
                "['NSFL','<a href=\"${pair.first.url}\">${pair.first.full}</a>','${pair.second.getTotalTPE()}','${pair.second.getAverageTPE()}','${pair.second.getTotalTPE()}','${pair.second.getAverageTPE()}','${pair.second.getOffensiveTPE(false)}','${pair.second.getDefensiveTPE(false)}']"
            } + "," + dsflList.joinToString(",") { pair ->
                "['DSFL','<a href=\"${pair.first.url}\">${pair.first.full}</a>','${pair.second.getTotalTPE()}','${pair.second.getAverageTPE()}','${pair.second.getTotalEffectiveTPE()}','${pair.second.getAverageEffectiveTPE()}','${pair.second.getOffensiveTPE(true)}','${pair.second.getDefensiveTPE(true)}']"
            }
    )

    fun createPositionStatsPage(
            positionList: List<Pair<Position, List<ActivePlayer>>>
    ) = POSITION_STATS_HTML.format(
            positionList.joinToString(",") { pair ->
                val nsflList = pair.second.filter { it.team.type == Team.Type.NSFL }
                val dsflList = pair.second.filter { it.team.type == Team.Type.DSFL }
                val freeAgentList = pair.second.filter { it.team.type == Team.Type.FREE_AGENT }
                val prospectList = pair.second.filter { it.team.type == Team.Type.PROSPECT }
                "['${pair.first.full}','${nsflList.size}','${dsflList.size}','${freeAgentList.size}','${prospectList.size}','${pair.second.size}'" +
                        ",'${nsflList.minBy(0) { it.currentTPE }}','${nsflList.maxBy(0) { it.currentTPE }}','${nsflList.sumBy { it.currentTPE } / nsflList.countOrOne()}'" +
                        ",'${dsflList.minBy(0) { it.currentTPE }}','${dsflList.maxBy(0) { it.currentTPE }}','${dsflList.sumBy { it.currentTPE } / dsflList.countOrOne()}']"
            }
    )

    fun createActivityCheckQueryPage() = ACTIVITY_CHECK_QUERY_HTML

    fun createActivityCheckResultPage(
            startDate: String,
            endDate: String,
            playerList: List<ActivePlayer>
    ): String {

        var oldestUpdateDate = Date()

        playerList.forEach {

            val date = playerDateFormat.parse(it.tpeHistoryList[1].first)

            if (date.before(oldestUpdateDate)) {
                oldestUpdateDate = date
            }
        }

        var newestUpdateDate = oldestUpdateDate

        playerList.forEach {

            val date = playerDateFormat.parse(it.tpeHistoryList.last().first)

            if (date.after(newestUpdateDate)) {
                newestUpdateDate = date
            }
        }

        var inputStartDate = inputDateFormat.parse(startDate)
        var inputEndDate = inputDateFormat.parse(endDate)

        if (inputStartDate.before(oldestUpdateDate)) {
            inputStartDate = oldestUpdateDate
        }

        if (inputEndDate.after(newestUpdateDate)) {
            inputEndDate = newestUpdateDate
        }

        val startingSaturday = Calendar.getInstance().apply {
            timeInMillis = inputStartDate.time
            if (get(Calendar.DAY_OF_WEEK) != Calendar.SATURDAY) {
                set(Calendar.DAY_OF_WEEK, Calendar.SATURDAY)
            }
        }.time

        val endingSaturday = Calendar.getInstance().apply {
            timeInMillis = inputEndDate.time
            if (get(Calendar.DAY_OF_WEEK) != Calendar.SATURDAY) {
                set(Calendar.DAY_OF_WEEK, Calendar.SATURDAY)
                add(Calendar.DAY_OF_YEAR, -7)
            }
        }.time

        val activityList = ArrayList<String>()

        playerList.forEach { player ->

            val startIndex = player.tpeHistoryList.indexOfFirst {
                if (it.first.isEmpty()) {
                    false
                } else {
                    !startingSaturday.after(playerDateFormat.parse(it.first))
                }
            }

            val endIndex = player.tpeHistoryList.indexOfFirst {
                if (it.first.isEmpty()) {
                    false
                } else {
                    !endingSaturday.after(playerDateFormat.parse(it.first))
                }
            }

            if (startIndex != -1 && endIndex != -1 && endIndex > startIndex) {

                var currentIndex = startIndex
                var tpeGained = 0
                var tpeLost = 0

                while (currentIndex < endIndex) {
                    val diff = player.tpeHistoryList[currentIndex + 1].second -
                            player.tpeHistoryList[currentIndex].second
                    if (diff < 0) {
                        tpeLost += diff
                    } else {
                        tpeGained += diff
                    }
                    currentIndex++
                }

                if (tpeGained != 0 || tpeLost != 0) {
                    activityList.add("['<a href=\"http://nsfl.jcink.net/index.php?showtopic=${player.id}\">${player.user}</a>','${player.draftYear}','<a href=\"${player.team.url}\">${player.team.full}</a>','<a href=\"/player?playerId=${player.id}\">${player.name}</a>','${player.position.full}','$tpeGained','$tpeLost','${tpeGained + tpeLost}','${player.currentTPE}','${player.highestTPE}','${player.lastUpdated}','${player.lastSeen}']")
                }
            }
        }

        return ACTIVITY_CHECK_RESULT_HTML.format(
                activityList.joinToString(","),
                "Activity Check: ${playerDateFormat.format(startingSaturday)} - ${playerDateFormat.format(endingSaturday)}"
        )
    }

    fun createTeamPage(
            team: Team,
            playerList: List<ActivePlayer>
    ) = INDIVIDUAL_TEAM_HTML.format(
            team.full,
            playerList.joinToString(",") {
                "['<a href=\"http://nsfl.jcink.net/index.php?showtopic=${it.id}\">${it.user}</a>','${it.draftYear}','<a href=\"/player?playerId=${it.id}\">${it.name}</a>','${it.position.full}','${it.currentTPE}','${it.highestTPE}','${it.lastUpdated}','${it.lastSeen}','${it.strength}','${it.agility}','${it.arm}','${it.intelligence}','${it.throwingAccuracy}','${it.tackling}','${it.speed}','${it.hands}','${it.passBlocking}','${it.runBlocking}','${it.endurance}','${it.kickPower}','${it.kickAccuracy}']"
            },
            "<a href=\"http://nsfl.jcink.net/index.php?showforum=${team.id}\">${team.full}</a>"
    )

    fun createRetiredPlayersPage(
            playerList: List<RetiredPlayer>
    ) = RETIRED_PLAYERS_HTML.format(
            playerList.joinToString(",") {
                "['${it.draftYear}','<a href=\"${it.team.url}\">${it.team.full}</a>','<a href=\"/player?playerId=${it.id}\">${it.name}</a>','${it.position.full}','${it.currentTPE}','${it.highestTPE}','${it.lastUpdated}']"
            }
    )

    fun createErrorPage(error: String, copyPasta: String) = ERROR_HTML.format(error, copyPasta)

    private fun List<Player>.getTotalTPE() = sumBy { it.currentTPE }

    private fun List<Player>.getAverageTPE() = getTotalTPE() / countOrOne()

    private fun List<Player>.getTotalEffectiveTPE() = sumBy { if (it.currentTPE > 250) 250 else it.currentTPE }

    private fun List<Player>.getAverageEffectiveTPE() = getTotalEffectiveTPE() / countOrOne()

    private fun List<Player>.getOffensiveTPE(dsfl: Boolean): Int {

        val qbList = filter { it.position == Position.QB }
                .sortedByDescending { it.currentTPE }

        val offenseList = filter {
            it.position == Position.RB
                    || it.position == Position.WR
                    || it.position == Position.TE
        }.sortedByDescending { it.currentTPE }

        return getPlayerTPESafe(qbList, 0, dsfl) +
                getPlayerTPESafe(offenseList, 0, dsfl) +
                getPlayerTPESafe(offenseList, 1, dsfl) +
                getPlayerTPESafe(offenseList, 2, dsfl) +
                getPlayerTPESafe(offenseList, 3, dsfl) +
                getPlayerTPESafe(offenseList, 4, dsfl)
    }

    private fun List<Player>.getDefensiveTPE(dsfl: Boolean): Int {

        val defenseList = filter {
            it.position == Position.DE
                    || it.position == Position.DT
                    || it.position == Position.LB
                    || it.position == Position.CB
                    || it.position == Position.S
        }.sortedByDescending { it.currentTPE }

        return getPlayerTPESafe(defenseList, 0, dsfl) +
                getPlayerTPESafe(defenseList, 1, dsfl) +
                getPlayerTPESafe(defenseList, 2, dsfl) +
                getPlayerTPESafe(defenseList, 3, dsfl) +
                getPlayerTPESafe(defenseList, 4, dsfl) +
                getPlayerTPESafe(defenseList, 5, dsfl) +
                getPlayerTPESafe(defenseList, 6, dsfl) +
                getPlayerTPESafe(defenseList, 7, dsfl) +
                getPlayerTPESafe(defenseList, 8, dsfl) +
                getPlayerTPESafe(defenseList, 9, dsfl) +
                getPlayerTPESafe(defenseList, 10, dsfl)
    }

    private fun getPlayerTPESafe(playerList: List<Player>, index: Int, dsfl: Boolean) = try {
        if (dsfl && playerList[index].currentTPE > 250) 250 else playerList[index].currentTPE
    } catch (exception: Exception) {
        50
    }

    private fun <T, R : Comparable<R>> Iterable<T>.minBy(default: R, selector: (T) -> R): R {
        val min = minBy { selector.invoke(it) }
        return if (min == null) {
            default
        } else {
            selector(min)
        }
    }

    private fun <T, R : Comparable<R>> Iterable<T>.maxBy(default: R, selector: (T) -> R): R {
        val max = maxBy { selector.invoke(it) }
        return if (max == null) {
            default
        } else {
            selector(max)
        }
    }

    private fun <T> Iterable<T>.countOrOne() = count().let { if (it == 0) 1 else it }
}
